<svg width="1200" height="1450" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1200" height="1450" fill="#1a1a2e"/>

  <!-- Title -->
  <text x="600" y="40" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#51B059" text-anchor="middle">
    Fluxo Real-time: Matchmaking e Gameplay via SignalR
  </text>

  <!-- Actor Headers -->
  <g id="actors">
    <!-- PlayerA -->
    <rect x="50" y="70" width="120" height="50" rx="8" fill="#3B96E6" opacity="0.9"/>
    <text x="110" y="100" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">Player A</text>

    <!-- PlayerB -->
    <rect x="210" y="70" width="120" height="50" rx="8" fill="#3B96E6" opacity="0.9"/>
    <text x="270" y="100" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">Player B</text>

    <!-- GameHub -->
    <rect x="370" y="70" width="150" height="50" rx="8" fill="#51B059" opacity="0.9"/>
    <text x="445" y="92" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">GameHub</text>
    <text x="445" y="110" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle">(SignalR)</text>

    <!-- Redis -->
    <rect x="560" y="70" width="120" height="50" rx="8" fill="#DC382D" opacity="0.9"/>
    <text x="620" y="92" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">Redis</text>
    <text x="620" y="110" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle">Cache</text>

    <!-- RabbitMQ -->
    <rect x="720" y="70" width="140" height="50" rx="8" fill="#FF6600" opacity="0.9"/>
    <text x="790" y="92" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">RabbitMQ</text>
    <text x="790" y="110" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle">Events</text>

    <!-- DataAPI -->
    <rect x="900" y="70" width="140" height="50" rx="8" fill="#3B96E6" opacity="0.9"/>
    <text x="970" y="92" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">Data API</text>
    <text x="970" y="110" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle">PostgreSQL</text>
  </g>

  <!-- Lifelines -->
  <line x1="110" y1="120" x2="110" y2="1420" stroke="#cccccc" stroke-width="2" stroke-dasharray="5,5" opacity="0.5"/>
  <line x1="270" y1="120" x2="270" y2="1420" stroke="#cccccc" stroke-width="2" stroke-dasharray="5,5" opacity="0.5"/>
  <line x1="445" y1="120" x2="445" y2="1420" stroke="#cccccc" stroke-width="2" stroke-dasharray="5,5" opacity="0.5"/>
  <line x1="620" y1="120" x2="620" y2="1420" stroke="#cccccc" stroke-width="2" stroke-dasharray="5,5" opacity="0.5"/>
  <line x1="790" y1="120" x2="790" y2="1420" stroke="#cccccc" stroke-width="2" stroke-dasharray="5,5" opacity="0.5"/>
  <line x1="970" y1="120" x2="970" y2="1420" stroke="#cccccc" stroke-width="2" stroke-dasharray="5,5" opacity="0.5"/>

  <!-- FASE 1: MATCHMAKING -->
  <rect x="20" y="150" width="1160" height="30" fill="#51B059" opacity="0.3"/>
  <text x="600" y="170" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#51B059" text-anchor="middle">
    FASE 1: MATCHMAKING
  </text>

  <!-- PlayerA joins -->
  <line x1="110" y1="200" x2="445" y2="200" stroke="#3B96E6" stroke-width="3" marker-end="url(#arrowblue)"/>
  <text x="270" y="195" font-family="Arial, sans-serif" font-size="14" fill="white">JoinMatchmaking()</text>

  <!-- GameHub to Redis -->
  <line x1="445" y1="230" x2="620" y2="230" stroke="#51B059" stroke-width="3" marker-end="url(#arrowgreen)"/>
  <text x="530" y="225" font-family="Arial, sans-serif" font-size="13" fill="white">Add to queue</text>
  <text x="530" y="242" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">matchmaking:queue</text>

  <!-- PlayerB joins -->
  <line x1="270" y1="270" x2="445" y2="270" stroke="#3B96E6" stroke-width="3" marker-end="url(#arrowblue)"/>
  <text x="355" y="265" font-family="Arial, sans-serif" font-size="14" fill="white">JoinMatchmaking()</text>

  <!-- Create match -->
  <line x1="445" y1="300" x2="620" y2="300" stroke="#51B059" stroke-width="3" marker-end="url(#arrowgreen)"/>
  <text x="530" y="295" font-family="Arial, sans-serif" font-size="13" fill="white">Create match</text>
  <text x="530" y="312" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">match:{matchId}</text>

  <!-- MatchFound to PlayerA -->
  <line x1="445" y1="340" x2="110" y2="340" stroke="#51B059" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowgreen)"/>
  <text x="270" y="335" font-family="Arial, sans-serif" font-size="14" fill="#51B059" font-weight="bold">MatchFound</text>

  <!-- MatchFound to PlayerB -->
  <line x1="445" y1="370" x2="270" y2="370" stroke="#51B059" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowgreen)"/>
  <text x="355" y="365" font-family="Arial, sans-serif" font-size="14" fill="#51B059" font-weight="bold">MatchFound</text>

  <!-- FASE 2: GAMEPLAY -->
  <rect x="20" y="420" width="1160" height="30" fill="#3B96E6" opacity="0.3"/>
  <text x="600" y="440" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#3B96E6" text-anchor="middle">
    FASE 2: GAMEPLAY (3 Rounds)
  </text>

  <!-- StartRound -->
  <line x1="110" y1="480" x2="445" y2="480" stroke="#3B96E6" stroke-width="3" marker-end="url(#arrowblue)"/>
  <text x="270" y="475" font-family="Arial, sans-serif" font-size="14" fill="white">StartRound()</text>

  <!-- Get random location -->
  <line x1="445" y1="510" x2="970" y2="510" stroke="#51B059" stroke-width="3" marker-end="url(#arrowgreen)"/>
  <text x="700" y="505" font-family="Arial, sans-serif" font-size="13" fill="white">GET /locations/random</text>

  <!-- Return location -->
  <line x1="970" y1="540" x2="445" y2="540" stroke="#51B059" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowgreen)"/>
  <text x="700" y="535" font-family="Arial, sans-serif" font-size="13" fill="white">LocationDto (x, y, heading)</text>

  <!-- Store answer in Redis -->
  <line x1="445" y1="570" x2="620" y2="570" stroke="#51B059" stroke-width="3" marker-end="url(#arrowgreen)"/>
  <text x="530" y="565" font-family="Arial, sans-serif" font-size="13" fill="white">Store answer</text>
  <text x="530" y="582" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">answer:{matchId}:{roundId}</text>

  <!-- RoundStarted to PlayerA -->
  <line x1="445" y1="610" x2="110" y2="610" stroke="#3B96E6" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowblue)"/>
  <text x="270" y="605" font-family="Arial, sans-serif" font-size="14" fill="#3B96E6" font-weight="bold">RoundStarted</text>
  <text x="270" y="622" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">(location, timer: 90s)</text>

  <!-- RoundStarted to PlayerB -->
  <line x1="445" y1="640" x2="270" y2="640" stroke="#3B96E6" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowblue)"/>
  <text x="355" y="635" font-family="Arial, sans-serif" font-size="14" fill="#3B96E6" font-weight="bold">RoundStarted</text>

  <!-- PlayerA submits guess -->
  <line x1="110" y1="680" x2="445" y2="680" stroke="#3B96E6" stroke-width="3" marker-end="url(#arrowblue)"/>
  <text x="270" y="675" font-family="Arial, sans-serif" font-size="14" fill="white">SubmitGuess(x, y)</text>

  <!-- Store guess A -->
  <line x1="445" y1="710" x2="620" y2="710" stroke="#51B059" stroke-width="3" marker-end="url(#arrowgreen)"/>
  <text x="530" y="705" font-family="Arial, sans-serif" font-size="13" fill="white">Store guess</text>
  <text x="530" y="722" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">guess:{matchId}:{roundId}:{playerAId}</text>

  <!-- PlayerB submits guess -->
  <line x1="270" y1="750" x2="445" y2="750" stroke="#3B96E6" stroke-width="3" marker-end="url(#arrowblue)"/>
  <text x="355" y="745" font-family="Arial, sans-serif" font-size="14" fill="white">SubmitGuess(x, y)</text>

  <!-- Store guess B -->
  <line x1="445" y1="780" x2="620" y2="780" stroke="#51B059" stroke-width="3" marker-end="url(#arrowgreen)"/>
  <text x="530" y="775" font-family="Arial, sans-serif" font-size="13" fill="white">Store guess</text>
  <text x="530" y="792" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">guess:{matchId}:{roundId}:{playerBId}</text>

  <!-- Calculate scores -->
  <rect x="395" y="820" width="100" height="60" rx="5" fill="#51B059" opacity="0.2" stroke="#51B059" stroke-width="2"/>
  <text x="445" y="840" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle" font-weight="bold">Calculate</text>
  <text x="445" y="855" font-family="Arial, sans-serif" font-size="11" fill="#cccccc" text-anchor="middle">Haversine</text>
  <text x="445" y="870" font-family="Arial, sans-serif" font-size="10" fill="#51B059" text-anchor="middle">5000Ã—e^(-d/2000)</text>

  <!-- Update match -->
  <line x1="445" y1="900" x2="620" y2="900" stroke="#51B059" stroke-width="3" marker-end="url(#arrowgreen)"/>
  <text x="530" y="895" font-family="Arial, sans-serif" font-size="13" fill="white">Update totals</text>

  <!-- RoundEnded to PlayerA -->
  <line x1="445" y1="940" x2="110" y2="940" stroke="#51B059" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowgreen)"/>
  <text x="270" y="935" font-family="Arial, sans-serif" font-size="14" fill="#51B059" font-weight="bold">RoundEnded</text>
  <text x="270" y="952" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">(points, distance, totals)</text>

  <!-- RoundEnded to PlayerB -->
  <line x1="445" y1="970" x2="270" y2="970" stroke="#51B059" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowgreen)"/>
  <text x="355" y="965" font-family="Arial, sans-serif" font-size="14" fill="#51B059" font-weight="bold">RoundEnded</text>

  <!-- Repeat indicator -->
  <rect x="400" y="1000" width="90" height="30" rx="5" fill="#3B96E6" opacity="0.5"/>
  <text x="445" y="1020" font-family="Arial, sans-serif" font-size="14" fill="white" text-anchor="middle" font-style="italic">Repeat 3x</text>

  <!-- FASE 3: MATCH END -->
  <rect x="20" y="1060" width="1160" height="30" fill="#FF6600" opacity="0.3"/>
  <text x="600" y="1080" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#FF6600" text-anchor="middle">
    FASE 3: MATCH END (After Round 3)
  </text>

  <!-- Determine winner -->
  <rect x="395" y="1120" width="100" height="50" rx="5" fill="#51B059" opacity="0.2" stroke="#51B059" stroke-width="2"/>
  <text x="445" y="1140" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle" font-weight="bold">Winner</text>
  <text x="445" y="1155" font-family="Arial, sans-serif" font-size="10" fill="#cccccc" text-anchor="middle">Max(totalPoints)</text>

  <!-- Publish to RabbitMQ -->
  <line x1="445" y1="1190" x2="790" y2="1190" stroke="#FF6600" stroke-width="3" marker-end="url(#arroworange)"/>
  <text x="610" y="1185" font-family="Arial, sans-serif" font-size="13" fill="white">Publish event</text>
  <text x="610" y="1202" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">match.ended</text>

  <!-- RabbitMQ to DataAPI -->
  <line x1="790" y1="1230" x2="970" y2="1230" stroke="#FF6600" stroke-width="3" marker-end="url(#arroworange)"/>
  <text x="880" y="1225" font-family="Arial, sans-serif" font-size="13" fill="white">Event</text>
  <text x="880" y="1242" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">match.ended</text>

  <!-- Update rankings -->
  <rect x="920" y="1260" width="100" height="50" rx="5" fill="#3B96E6" opacity="0.2" stroke="#3B96E6" stroke-width="2"/>
  <text x="970" y="1280" font-family="Arial, sans-serif" font-size="11" fill="white" text-anchor="middle" font-weight="bold">Update</text>
  <text x="970" y="1295" font-family="Arial, sans-serif" font-size="10" fill="#cccccc" text-anchor="middle">PlayerStats</text>

  <!-- Delete match cache -->
  <line x1="445" y1="1330" x2="620" y2="1330" stroke="#DC382D" stroke-width="3" marker-end="url(#arrowred)"/>
  <text x="530" y="1325" font-family="Arial, sans-serif" font-size="13" fill="white">Delete cache</text>
  <text x="530" y="1342" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">match:{matchId}</text>

  <!-- MatchEnded to PlayerA -->
  <line x1="445" y1="1380" x2="110" y2="1380" stroke="#FF6600" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arroworange)"/>
  <text x="270" y="1375" font-family="Arial, sans-serif" font-size="14" fill="#FF6600" font-weight="bold">MatchEnded</text>
  <text x="270" y="1392" font-family="Arial, sans-serif" font-size="11" fill="#cccccc">(winner, final points, ranking)</text>

  <!-- MatchEnded to PlayerB -->
  <line x1="445" y1="1410" x2="270" y2="1410" stroke="#FF6600" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arroworange)"/>
  <text x="355" y="1405" font-family="Arial, sans-serif" font-size="14" fill="#FF6600" font-weight="bold">MatchEnded</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowblue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#3B96E6"/>
    </marker>
    <marker id="arrowgreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#51B059"/>
    </marker>
    <marker id="arroworange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#FF6600"/>
    </marker>
    <marker id="arrowred" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#DC382D"/>
    </marker>
  </defs>
</svg>
